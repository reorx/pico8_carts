pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- dodge

-- define actor
actor_type = {}

function actor_type:new(tx, ty)
    local actor = {
        tx = tx,
        ty = ty,
        dx = 0,
        dy = 0,
        spr = 0,
        frame = 0,
        frames = 7,
        inertia = 0.8,
        moveunit = 0.05,
        tick = 0,
    }
    self.__index = self
    return setmetatable(actor, self)
end

function actor_type:draw()
    local x = (self.tx * 8) + 4
    local y = (self.ty * 8) + 4
    spr(self.spr + self.frame, x, y)
end

cube_type = actor_type:new(0, 0)

function cube_type:control()
    -- calculate dx, dy
    local _f = flr(self.tick / 2) % 2
    local moving = 0
    if btn(0) then
        self.dx -= self.moveunit
        self.spr = 8 + _f
        moving += 1
    end
    if btn(1) then
        self.dx += self.moveunit
        self.spr = 6 + _f
        moving += 1
    end
    if btn(2) then
        self.dy -= self.moveunit
        self.spr = 10 + _f
        moving += 1
    end
    if btn(3) then
        self.dy += self.moveunit
        self.spr = 4 + _f
        moving += 1
    end
    if moving == 0 then
        self.spr = 16 + flr(self.tick / 5) % 4
    end
    -- slow down double direction moving
    if moving > 1 then
        self.dx *= 0.8
        self.dy *= 0.8
    end

    -- update tx, ty
    self.tx += self.dx
    self.ty += self.dy

    -- inertia
    self.dx *= self.inertia
    self.dy *= self.inertia

    -- tick
    self.tick += 1
end

function _init()
    cube = cube_type:new(3, 3)
    cube.spr = 2
end

function _update()
    cube:control()
    -- cube.tx += 1/30
    -- cube.ty += 1/20
end

function _draw()
    cls()
    rectfill(0,0,127,127,6)
    map(0,0,0,0,16,14)
    cube:draw()
    debug()
end

debugx= 2
debugy_end = 121
linesp = 8
debugcolor = 7
function dprint(s, index)
	print(s, debugx, debugy_end-linesp*index, debugcolor)
end

function debug()
	dprint("tx: "..cube.tx.." dx:"..cube.dx, 1)
	dprint("ty: "..cube.ty.." dy:"..cube.dy, 0)
end
__gfx__
00000000000cc0000000000000000000000cc000070cc070070cc000000cc000000cc070000cc000000cc000000cc00000000000000000000000000000000000
0000000000cccc00000000000000000070cccc0700cccc0000cccc0070cccc0000cccc0000cccc0700cccc0000cccc0000000000000000000000000000000000
007007000ccc7cc000000000000000000cc77cc00cc77cc00cccc7c00cccc7c00c7cccc00c7cccc00cc11cc00cc11cc000000000000000000000000000000000
000770000c777cc000000000000000000c7777c00c7777c001cc777001cc77700777cc100777cc100c1111c00c1111c000000000000000000000000000000000
000770000cc777c000000000000000000c7777c00c7777c001cc777001cc77700777cc100777cc100c1111c00c1111c000000000000000000000000000000000
007007000cc7ccc000000000000000000cc77cc00cc77cc00cccc7c00cccc7c00c7cccc00c7cccc00cc11cc00cc11cc000000000000000000000000000000000
0000000000cccc00000000000000000000cccc0000cccc0000cccc0070cccc0000cccc0000cccc0770cccc0700cccc0000000000000000000000000000000000
00000000000cc0000000000000000000000cc000000cc000070cc000000cc000000cc070000cc000000cc000070cc07000000000000000000000000000000000
000cc000000cc000000cc000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc0000cccc0000cccc0000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc00cccccc00cccccc00cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ccc7cc00cccccc00cccccc00cc7ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc00ccc7cc00cc7ccc00cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc00cccccc00cccccc00cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc0000cccc0000cccc0000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000cc000000cc000000cc000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
449999aaaa9999440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444999aaaaa999440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44499aaaaaa994440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44999aaaaa9994440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
449999aaaa9999440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444999aaaaa999440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44499aaaaaa994440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44999aaaaa9994440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0fffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0fffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d0d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dd0dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
